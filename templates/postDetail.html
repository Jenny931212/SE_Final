<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>æ¡ˆå­è©³æƒ…</title>
    <style>
        body {
            font-family: "Noto Sans TC", Arial, sans-serif;
            background-color: #f7faff;
            color: #333;
            margin: 40px;
            line-height: 1.7;
        }

        h1 {
            text-align: center;
            color: #1d5ea8;
            font-weight: 800;
            margin-bottom: 25px;
        }

        h3 {
            color: #1d5ea8;
            margin-top: 40px;
            border-left: 4px solid #5ca8ff;
            padding-left: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .content {
            width: 720px;
            margin: 0 auto;
            background: #fff;
            border-radius: 12px;
            padding: 35px 45px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        }

        p {
            margin: 10px 0;
            font-size: 15.5px;
        }

        strong {
            color: #245a9b;
        }

        hr {
            border: none;
            border-top: 1px solid #e0ecff;
            margin: 25px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 15px;
        }

        th, td {
            border: 1px solid #e0ecff;
            padding: 10px;
            text-align: center;
        }

        th {
            background-color: #eaf4ff;
            color: #1d5ea8;
            font-weight: 700;
        }

        tr:nth-child(even) { background-color: #f8fbff; }
        tr:hover { background-color: #edf5ff; }

        a {
            text-decoration: none;
            color: #2b6cb0;
            font-weight: 600;
        }

        a:hover { text-decoration: underline; color: #1a5da0; }

        .accepted { color: #2e8b57; font-weight: bold; }
        .rejected { color: #999; }
        .pending { color: #e39d00; }
        .reviewing { color: #c0392b; font-weight: bold; }
        .completed { color: #2e8b57; font-weight: bold; }

        /* ä¸Šå‚³ç›’å­ */
        .upload-box {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 14px;
            flex-wrap: wrap;
        }

        /* éš±è—åŸç”Ÿ input */
        #file-input { display: none; }

        /* ç¾åŒ–å¾Œçš„ Upload æŒ‰éˆ• */
        .upload-btn {
            background: linear-gradient(135deg, #7ec8ff, #4fa8ff);
            padding: 10px 22px;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 15px;
            transition: all 0.25s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(90, 150, 255, 0.25);
        }

        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 18px rgba(80, 140, 255, 0.35);
        }

        /* æª”å */
        .file-name {
            font-size: 14px;
            color: #245a9b;
            min-width: 200px;
            background: #eef6ff;
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid #d0e5ff;
        }

        /* é€å‡ºæŒ‰éˆ• */
        .submit-btn {
            background: linear-gradient(135deg, #1d5ea8, #144b87);
            padding: 10px 20px;
            color: white;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all 0.25s ease;
            box-shadow: 0 4px 10px rgba(29,94,168,0.25);
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 18px rgba(29,94,168,0.35);
        }

        .back {
            display: block;
            text-align: center;
            margin-top: 25px;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <h1>æ¡ˆå­è©³æƒ…</h1>
    <div class="content">

        <p><strong>æ¨™é¡Œï¼š</strong>{{ job.title }}</p>
        <p><strong>å§”è¨—è€…ï¼ˆç”²æ–¹ï¼‰ï¼š</strong>{{ job.owner_name }}</p>
        <p><strong>æè¿°ï¼š</strong>{{ job.description or "ï¼ˆç„¡æè¿°ï¼‰" }}</p>
        <p><strong>é ç®—ï¼š</strong>{{ job.budget }}</p>

        <p>
            <strong>ç‹€æ…‹ï¼š</strong>
            {% if job.status == "bidding" %}
                <span style="color: #e39d00;">å ±åƒ¹ä¸­</span>
            {% elif job.status == "pending_review" %}
                <span style="color: #7b5cc1;">ç­‰å¾…ç”²æ–¹æŒ‘é¸å ±åƒ¹</span>
            {% elif job.status == "in_progress" %}
                <span style="color: #1d5ea8;">åŸ·è¡Œä¸­</span>
            {% elif job.status == "reviewing" %}
                <span class="reviewing">å¾…ç”²æ–¹å¯©æ ¸/é©—æ”¶</span>
            {% elif job.status == "completed" %}
                <span class="completed">å·²å®Œæˆ ğŸ‰</span>
            {% endif %}
        </p>

        <p><strong>æˆªæ­¢æ™‚é–“ï¼š</strong>
            {% if job.bidding_deadline %}
                {{ job.bidding_deadline }}
            {% else %}
                æœªè¨­å®š
            {% endif %}
        </p>

        <hr />

        <h3>å ±åƒ¹æ¸…å–®ï¼ˆä¹™æ–¹ï¼‰</h3>

        {% if bids %}
        <table>
            <tr>
                <th>ID</th>
                <th>å ±åƒ¹è€…</th>
                <th>é‡‘é¡</th>
                <th>è¨Šæ¯</th>
                <th>ç‹€æ…‹</th>
                <th>æ“ä½œ</th>
            </tr>

            {% for b in bids %}
            <tr>
                <td>{{ b.id }}</td>
                <td>{{ b.bidder_name }}</td>
                <td>{{ b.price }}</td>
                <td>{{ b.message }}</td>
                <td>
                    {% if b.status == "pending" %}
                        <span class="pending">å¾…å¯©æ ¸</span>
                    {% elif b.status == "accepted" %}
                        <span class="accepted">å·²æ¥å—</span>
                    {% elif b.status == "rejected" %}
                        <span class="rejected">å·²æ‹’çµ•</span>
                    {% endif %}
                </td>
                <td>
                    {# â­ ä¿®æ­£å¾Œçš„è·¯ç”±ï¼Œé¿å…è¡çª #}
                    {% if job.status in ["bidding", "pending_review"] and b.status == "pending" %}
                        <a href="/jobs/actions/accept_bid/{{ job.id }}/{{ b.id }}" style="color: #2e8b57; font-weight: bold;">æ¥å—</a> â”‚ 
                        <a href="/jobs/actions/reject_bid/{{ job.id }}/{{ b.id }}" style="color: #c0392b;">æ‹’çµ•</a>
                    {% else %} â€” {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
            <p>ç›®å‰å°šç„¡å ±åƒ¹ã€‚</p>
        {% endif %}

        {# ============================================================== #}
        {# â­ ç”²æ–¹å¯©æ ¸æ“ä½œå€å¡Š (åƒ…åœ¨ reviewing ç‹€æ…‹ä¸”ç‚ºæ¡ˆä¸»æ™‚é¡¯ç¤º) #}
        {# ============================================================== #}
        {% if job.status == "reviewing" and role == "client" and current_user_id == job.owner_id %}
            <hr style="margin-top: 25px;"/>
            <h3 style="color: #c0392b;">ç”²æ–¹å¯©æ ¸æ“ä½œ (å¾…é©—æ”¶)</h3>
            <p style="margin-top: 15px">
                ğŸ”´ <a href="/jobs/reject_work/{{ job.id }}" style="color: #c0392b; font-weight: bold;" 
                   onclick="return confirm('ç¢ºå®šè¦é€€å›çµ¦ä¹™æ–¹ä¿®æ”¹å—ï¼Ÿé€€å›å¾Œï¼Œç‹€æ…‹å°‡å›åˆ°åŸ·è¡Œä¸­ (in_progress)ã€‚');">
                   è¦æ±‚ä¿®æ”¹/é€€ä»¶
                </a>
                
                <span style="margin: 0 15px;">|</span>
                
                ğŸ“¦ <a href="/jobs/complete/{{ job.id }}" style="color: #2e8b57; font-weight: bold;"
                   onclick="return confirm('ç¢ºå®šé©—æ”¶æˆæœä¸¦çµæ¡ˆå—ï¼Ÿçµæ¡ˆå¾Œå°‡ç„¡æ³•ä¿®æ”¹ç‹€æ…‹ã€‚');">
                   âœ… é©—æ”¶ä¸¦çµæ¡ˆ
                </a>
            </p>
        {% endif %}

        {# åŸ·è¡Œä¸­/å·²å®Œæˆç‹€æ…‹æ“ä½œ #}
        {% if job.status == "in_progress" %}
        <p style="margin-top: 15px">
            {% if role == "client" and current_user_id == job.owner_id %}
            {# åªæœ‰ç”²æ–¹èƒ½æ‰‹å‹•æ¨™è¨˜å®Œæˆ (åœ¨ä¹™æ–¹å°šæœªé€å¯©æ™‚) #}
            ğŸ“¦ <a href="/jobs/complete/{{ job.id }}">æ¨™è¨˜ç‚ºå®Œæˆ</a>
            {% else %}
            <span style="color: #1d5ea8;">ç­‰å¾…ä¹™æ–¹æäº¤æˆæœ</span>
            {% endif %}
        </p>
        {% elif job.status == "completed" %}
        <p style="color: green">æ­¤æ¡ˆå·²å®Œæˆï¼Œæ„Ÿè¬åˆä½œï¼ğŸ‰</p>
        {% endif %}

        <hr />

        <h3>é™„ä»¶ä¸Šå‚³</h3>

        {# ä¸Šå‚³æ¬Šé™ç”± jobs.py çš„ job_detail å‚³å…¥ can_upload æ§åˆ¶ #}
        {% if can_upload %}
        <form action="/jobs/upload" method="post" enctype="multipart/form-data" class="upload-box">
            <input type="hidden" name="job_id" value="{{ job.id }}">

            <label for="file-input" class="upload-btn">ğŸ“„ é¸æ“‡æª”æ¡ˆ</label>
            <input id="file-input" type="file" name="file" required>

            <span id="file-name" class="file-name">å°šæœªé¸æ“‡æª”æ¡ˆ</span>

            <button type="submit" class="submit-btn">ä¸Šå‚³</button>
        </form>

        <script>
            const fileInput = document.getElementById("file-input");
            const fileName = document.getElementById("file-name");

            fileInput.addEventListener("change", () => {
                fileName.textContent = fileInput.files.length
                    ? fileInput.files[0].name
                    : "å°šæœªé¸æ“‡æª”æ¡ˆ";
            });
        </script>

        {% else %}
        <p style="color: gray;">ï¼ˆä½ æ²’æœ‰ä¸Šå‚³æ¬Šé™ï¼‰</p>
        {% endif %}

       {% if files %}
        {# â­ ä¿®æ­£å¾Œçš„æ­·å²æª”æ¡ˆåˆ—è¡¨ï¼šé¡¯ç¤ºç‰ˆæœ¬ã€å„ªåŒ–æ¨£å¼ #}
        <h4>å·²ä¸Šå‚³çš„æª”æ¡ˆï¼š</h4>
        <ul style="list-style-type: none; padding-left: 0;">
            {% for f in files %}
            <li style="margin-bottom: 8px; border-left: 3px solid #6cb8ff; padding-left: 10px;">
                <a href="/static/uploads/{{ f.filename }}" download style="font-weight: bold; color: #2e3b55;">
                    ğŸ“„ {{ f.original_name }} 
                </a>
                
                <span style="font-size: 14px; color: #666; margin-left: 10px;">
                    (ç‰ˆæœ¬: V{{ f.version or 1 }}ï¼Œä¸Šå‚³è€…: {{ f.uploader_name }}ï¼Œè§’è‰²: {{ f.role }}ï¼Œ
                    ä¸Šå‚³æ™‚é–“: {{ f.upload_time | default('æœªçŸ¥') }})
                </span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>ç›®å‰æ²’æœ‰ä¸Šå‚³çš„æª”æ¡ˆã€‚</p>
        {% endif %}

        <hr />
        <a class="back" href="/jobs/">è¿”å›åˆ—è¡¨</a>
    </div>
</body>
</html>

        <hr />
        <a class="back" href="/jobs/">è¿”å›åˆ—è¡¨</a>
    </div>
</body>
</html>