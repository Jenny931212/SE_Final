{% extends "base.html" %}
{% block content %}

<h2>評價{{ role_label }}：{{ target_name }}</h2>
<p>
  您正在針對「<b>{{ project.title }}</b>」這個案件，
  評價{{ role_label }} <b>{{ target_name }}</b>。<br>
  評價期限：結案後 {{ deadline_days }} 天內可以填寫。<br>

  {% if remain_days > 0 or remain_hours > 0 %}
    <span style="color:red">剩餘時間：{{ remain_days }} 天 {{ remain_hours }} 小時</span>
  {% else %}
    剩餘時間：已超過評價期限（仍可進入此頁，但送出時可以在後端再擋）
  {% endif %}
</p>


<!-- 小小的樣式（之後你也可以搬去自己的 CSS） -->
<style>
  .rating-box {
    display: inline-block;
  }
  .rating-box .fa {
    cursor: pointer;
    font-size: 24px;
    margin-right: 4px;
    color: #d1d5db; /* 預設灰色 */
  }
  .rating-box .fa-star {
    color: #fbbf24; /* 填滿的星星顏色（金黃色） */
  }
  .rating-hint {
    margin-left: 8px;
    font-size: 0.9rem;
    color: #555;
  }
</style>

<form method="post" action="/projects/{{ project.id }}/rate">
  <!-- 告訴後端這次是評 client 還是 contractor -->
  <input type="hidden" name="target" value="{{ target_role }}">

  <!-- 維度一 -->
  <div class="form-group">
    <label>{{ dim_labels[0] }}（1~5）：</label>
    <div class="rating-box" data-input-id="score_1">
      <span class="fa fa-star-o" data-value="1"></span>
      <span class="fa fa-star-o" data-value="2"></span>
      <span class="fa fa-star-o" data-value="3"></span>
      <span class="fa fa-star-o" data-value="4"></span>
      <span class="fa fa-star-o" data-value="5"></span>
    </div>
    <!-- 真正送給後端的數字 -->
    <input type="hidden" name="score_1" id="score_1" value="0">
  </div>

  <!-- 維度二 -->
  <div class="form-group">
    <label>{{ dim_labels[1] }}（1~5）：</label>
    <div class="rating-box" data-input-id="score_2">
      <span class="fa fa-star-o" data-value="1"></span>
      <span class="fa fa-star-o" data-value="2"></span>
      <span class="fa fa-star-o" data-value="3"></span>
      <span class="fa fa-star-o" data-value="4"></span>
      <span class="fa fa-star-o" data-value="5"></span>
    </div>
    <input type="hidden" name="score_2" id="score_2" value="0">
  </div>

  <!-- 維度三 -->
  <div class="form-group">
    <label>{{ dim_labels[2] }}（1~5）：</label>
    <div class="rating-box" data-input-id="score_3">
      <span class="fa fa-star-o" data-value="1"></span>
      <span class="fa fa-star-o" data-value="2"></span>
      <span class="fa fa-star-o" data-value="3"></span>
      <span class="fa fa-star-o" data-value="4"></span>
      <span class="fa fa-star-o" data-value="5"></span>
    </div>
    <input type="hidden" name="score_3" id="score_3" value="0">
  </div>

  <div class="form-group">
    <label>質性評論（可選填）：</label><br>
    <textarea name="comment" rows="5" style="width:100%; max-width:700px;"></textarea>
  </div>

  <p>
    <button type="submit" class="btn">送出評價</button>
    <a href="/projects/{{ project.id }}" class="btn secondary">取消</a>
  </p>
</form>

<!-- 星星評分的 JavaScript（專門把「點星星」變成 hidden input 的數字） -->
<script>
  function initRatingBox(box) {
    const inputId = box.dataset.inputId;                 // e.g. "score_1"
    const hiddenInput = document.getElementById(inputId);
    const stars = box.querySelectorAll(".fa");

    let current = 0; // 目前選定的分數

    function paint(n) {
      stars.forEach((s, idx) => {
        if (idx < n) {
          s.classList.remove("fa-star-o");
          s.classList.add("fa-star");
        } else {
          s.classList.remove("fa-star");
          s.classList.add("fa-star-o");
        }
      });
    }

    stars.forEach(star => {
      const val = parseInt(star.dataset.value); // 1~5

      // 滑過星星 → 亮起（不顯示提示文字）
      star.addEventListener("mouseover", () => {
        paint(val);
      });

      // 點擊星星 → 設定分數（不顯示提示文字）
      star.addEventListener("click", () => {
        current = val;
        hiddenInput.value = val;  // ★回寫選擇的分數
      });

      // 滑鼠離開 → 顯示已選的分數（不顯示提示文字）
      star.addEventListener("mouseout", () => {
        paint(current);
      });
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".rating-box").forEach(initRatingBox);
  });
</script>


{% endblock %}
